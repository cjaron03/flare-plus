#!/usr/bin/env bash
set -euo pipefail

# Ensure we run from repo root
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || echo ".")"
cd "$REPO_ROOT"

echo "Running pre-commit checks (Black formatting)..."

# Prefer `black` if available, else fall back to python -m black
if command -v black >/dev/null 2>&1; then
  BLACK_CMD=(black)
elif command -v python3 >/dev/null 2>&1; then
  BLACK_CMD=(python3 -m black)
elif command -v python >/dev/null 2>&1; then
  BLACK_CMD=(python -m black)
else
  echo "Error: Black is not installed. Install dev deps or run:"
  echo "  pip install black    (or)    uv pip install black"
  exit 1
fi

# Run the same check as CI to block commits that would fail later
"${BLACK_CMD[@]}" --check src/ tests/ scripts/ || {
  echo
  echo "✗ Black formatting issues detected. Fix with:"
  echo "  ${BLACK_CMD[*]} src/ tests/ scripts/"
  echo
  exit 1
}

echo "✓ Formatting looks good"
exit 0

